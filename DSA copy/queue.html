<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSA Visualizer - Queue & Deque & Priority Queue</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
      100% { transform: scale(1); }
    }
    @keyframes shrink {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0); opacity: 0; }
    }
    #codeExecution {
      scrollbar-width: thin;
      scrollbar-color: #4b5563 #1f2937;
    }
    #codeExecution::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    #codeExecution::-webkit-scrollbar-track {
      background: #1f2937;
    }
    #codeExecution::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 3px;
    }
    .code-line {
      padding: 4px 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
      margin: 2px 0;
    }
    .code-line.highlight {
      background-color: rgba(234, 179, 8, 0.15);
      border-left: 3px solid #eab308;
    }
    #peekInfo {
  width: 100%;
  text-align: center;
}
    textarea {
      scrollbar-width: thin;
      scrollbar-color: #4b5563 #1f2937;
    }
    textarea::-webkit-scrollbar {
      width: 8px;
    }
    textarea::-webkit-scrollbar-track {
      background: #1f2937;
    }
    textarea::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 4px;
    }
    .box-heading {
      font-weight: 600;
      font-size: 1.15rem;
      color: #a5b4fc;
      margin-bottom: 10px;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #outputConsole {
      background: #1f2937;
      padding: 14px;
      border-radius: 8px;
      border: 1px solid #374151;
      font-family: 'Fira Code', monospace;
      font-size: 14px;
      min-height: 80px;
      white-space: pre-wrap;
      overflow-y: auto;
      margin-top: 12px;
      color: #e5e7eb;
      line-height: 1.5;
    }
    .queue-box, .pq-box {
      min-height: 280px;
      height: 280px;
      background: #1f2937;
      border-radius: 8px;
      border: 1px solid #374151;
      padding: 18px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      overflow: auto;
    }
    .queue-visual, .pq-visual {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      min-height: 60px;
      margin: 0 auto;
      margin-top: 12px;
      flex-wrap: wrap;
      max-width: 100%;
    }
    .queue-node, .pq-node {
      width: 60px;
      height: 42px;
      background: #4f46e5;
      color: white;
      font-weight: 600;
      border-radius: 6px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 15px;
      position: relative;
      transition: all 0.2s ease;
      border: 1px solid #6366f1;
      box-shadow: 0 2px 8px rgba(79, 70, 229, 0.2);
      flex-shrink: 0;
    }
    .queue-node.added, .pq-node.added {
      background: #10b981;
      border-color: #34d399;
      animation: pulse 0.8s ease-out;
    }
    .queue-node.removed, .pq-node.removed {
      background: #ef4444;
      border-color: #f87171;
      animation: shrink 0.6s ease-out forwards;
    }
    .pq-priority {
      font-size: 12px;
      color: #f59e42;
      font-weight: 600;
      margin-top: 2px;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex">

  <!-- Sidebar -->
  <nav class="w-64 bg-gray-800 text-white p-6 flex flex-col border-r border-gray-700">
    <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
      DSA Visualizer
    </h2>
    <ul class="flex flex-col gap-3">
      <li>
        <a href="idx.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          Array
        </a>
      </li>
      <li>
        <a href="linked.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
          Linked List
        </a>
      </li>
      <li>
        <a href="stack.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l4-4m-4 4l4 4" />
          </svg>
          Stack
        </a>
      </li>
      <li>
        <a href="queue.html" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-indigo-900/30 text-indigo-300 font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
          </svg>
          Queue
        </a>
      </li>
      <li>
        <a href="tree.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z" />
          </svg>
          Tree
        </a>
      </li>
      <li>
        <a href="graph.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
          </svg>
          Graph
        </a>
      </li>
      <li>
        <a href="heap.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
          Heap
        </a>
      </li>
      <li>
        <a href="hashing.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700/50 text-gray-300 hover:text-white font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
          </svg>
          Hashing
        </a>
      </li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="flex-1 p-6 max-w-5xl mx-auto flex flex-col gap-4">
    <h1 class="text-3xl font-bold text-indigo-300 flex items-center gap-2 mt-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
      </svg>
      Queue Visualizer
    </h1>
    
    <div class="mb-2">
      <label class="font-medium text-gray-300 mr-2">Queue Type:</label>
      <select id="queueType" class="bg-gray-800 border border-gray-700 rounded px-3 py-1.5 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        <option value="queue">Queue</option>
        <option value="priority">Priority Queue</option>
      </select>
    </div>
    
    <textarea
      id="codeInput"
      rows="8"
      class="w-full p-4 bg-gray-800 border border-gray-700 rounded-lg font-mono text-sm resize-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
      placeholder="Write your JS queue/deque/priority queue code here, e.g.
let queue = [];
queue.push(10);        // enqueueBack
queue.unshift(5);      // enqueueFront
queue.shift();         // dequeueFront
queue.pop();           // dequeueBack
let front = queue[0];  // peek front
let back = queue[queue.length-1];  // peek back
let size = queue.length;

let pq = [];
pq.push([10, 2]);      // [value, priority]
pq.push([20, 1]);
pq.sort((a,b) => b[1] - a[1]); // highest priority first
pq.shift();            // dequeue highest priority"
    ></textarea>
    
    <button
      id="runBtn"
      class="px-6 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition self-start flex items-center gap-2 font-medium shadow-lg hover:shadow-indigo-500/20 active:scale-95"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l3-2z" clip-rule="evenodd" />
      </svg>
      Run & Visualize
    </button>

    <div class="flex gap-6 mt-2">
      <!-- Code Execution Highlight -->
      <section class="w-1/2 bg-gray-800 p-4 rounded-lg border border-gray-700 font-mono text-base whitespace-pre-wrap overflow-auto h-[320px] flex flex-col">
        <div class="flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          <span class="ml-1 text-indigo-300 font-medium">Code Execution</span>
        </div>
        <div id="codeExecution" class="flex-grow overflow-auto mt-1"></div>
      </section>

      <!-- Queue and Priority Queue Visualization -->
      <div class="w-1/2 flex flex-col">
        <div id="queueBoxWrap">
          <div class="box-heading">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
            </svg>
            Queue / Deque Visualization
          </div>
          <section class="queue-box">
            <div id="queueContainer" class="queue-visual"></div>
            <div id="peekInfo" class="mt-2 text-indigo-300 font-medium"></div>
            <div id="sizeInfo" class="mt-1 text-gray-400 font-medium"></div>
          </section>
        </div>
        <div id="pqBoxWrap" style="display:none;">
          <div class="box-heading">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
            </svg>
            Priority Queue Visualization
          </div>
          <section class="pq-box">
            <div id="pqContainer" class="pq-visual"></div>
            <div id="pqPeekInfo" class="mt-2 text-indigo-300 font-medium"></div>
            <div id="pqSizeInfo" class="mt-1 text-gray-400 font-medium"></div>
          </section>
        </div>
      </div>
    </div>

    <!-- Output Console Section -->
    <section>
      <div class="box-heading">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        Output Console
      </div>
      <div id="outputConsole" tabindex="0"></div>
    </section>
  </main>

  <script>
    // Code templates for each queue type
    const queueTemplates = {
      queue: `let queue = [];
queue.push(10);        // enqueueBack
queue.unshift(5);      // enqueueFront
queue.shift();         // dequeueFront
queue.pop();           // dequeueBack
let front = queue[0];  // peek front
let back = queue[queue.length-1];  // peek back
let size = queue.length;`,
      priority: `let pq = [];
pq.push([10, 2]);      // [value, priority]
pq.push([20, 1]);
pq.sort((a,b) => b[1] - a[1]); // highest priority first
pq.shift();            // dequeue highest priority
let top = pq[0];       // peek highest priority
let size = pq.length;`
    };

    const runBtn = document.getElementById("runBtn");
    const codeInput = document.getElementById("codeInput");
    const codeExecution = document.getElementById("codeExecution");
    const queueContainer = document.getElementById("queueContainer");
    const pqContainer = document.getElementById("pqContainer");
    const peekInfo = document.getElementById("peekInfo");
    const sizeInfo = document.getElementById("sizeInfo");
    const pqPeekInfo = document.getElementById("pqPeekInfo");
    const pqSizeInfo = document.getElementById("pqSizeInfo");
    const outputConsole = document.getElementById("outputConsole");
    const queueType = document.getElementById("queueType");
    const queueBoxWrap = document.getElementById("queueBoxWrap");
    const pqBoxWrap = document.getElementById("pqBoxWrap");

    // Set initial code template and toggle visualization
    function updateQueueUI() {
      if (queueType.value === "queue") {
        queueBoxWrap.style.display = "";
        pqBoxWrap.style.display = "none";
      } else {
        queueBoxWrap.style.display = "none";
        pqBoxWrap.style.display = "";
      }
      // Do NOT set codeInput.value here!
      codeInput.placeholder = queueType.value === "queue"
        ? `Write your JS queue/deque code here, e.g.
let queue = [];
queue.push(10);        // enqueueBack
queue.unshift(5);      // enqueueFront
queue.shift();         // dequeueFront
queue.pop();           // dequeueBack
let front = queue[0];  // peek front
let back = queue[queue.length-1];  // peek back
let size = queue.length;`
        : `Write your JS priority queue code here, e.g.
let pq = [];
pq.push([10, 2]);      // [value, priority]
pq.push([20, 1]);
pq.sort((a,b) => b[1] - a[1]); // highest priority first
pq.shift();            // dequeue highest priority
let top = pq[0];       // peek highest priority
let size = pq.length;`;
    }
    queueType.addEventListener("change", updateQueueUI);
    window.addEventListener("DOMContentLoaded", updateQueueUI);

    function appendOutput(text) {
      outputConsole.textContent += text + "\n";
      outputConsole.scrollTop = outputConsole.scrollHeight;
    }

    function renderQueue(q, highlightIdx = null, action = null) {
      queueContainer.innerHTML = "";
      if (q.length === 0) {
        queueContainer.innerHTML = `<div class="text-gray-400 italic">Queue is empty</div>`;
        return;
      }
      q.forEach((item, idx) => {
        const box = document.createElement("div");
        box.className = "queue-node";
        if (highlightIdx === idx && action === "add") box.classList.add("added");
        if (highlightIdx === idx && action === "remove") box.classList.add("removed");
        box.textContent = item;
        queueContainer.appendChild(box);
      });
    }

    function renderPQ(pq, highlightIdx = null, action = null) {
      pqContainer.innerHTML = "";
      if (pq.length === 0) {
        pqContainer.innerHTML = `<div class="text-gray-400 italic">Priority queue is empty</div>`;
        return;
      }
      pq.forEach((item, idx) => {
        const box = document.createElement("div");
        box.className = "pq-node";
        if (highlightIdx === idx && action === "add") box.classList.add("added");
        if (highlightIdx === idx && action === "remove") box.classList.add("removed");
        if (Array.isArray(item)) {
          box.innerHTML = `<div>${item[0]}</div><div class="pq-priority">p:${item[1]}</div>`;
        } else {
          box.textContent = item;
        }
        pqContainer.appendChild(box);
      });
    }

    runBtn.addEventListener("click", async () => {
      const code = codeInput.value.trim();
      if (!code) return alert("Please enter some code");

      codeExecution.innerHTML = "";
      queueContainer.innerHTML = "";
      pqContainer.innerHTML = "";
      peekInfo.textContent = "";
      sizeInfo.textContent = "";
      pqPeekInfo.textContent = "";
      pqSizeInfo.textContent = "";
      outputConsole.textContent = "";

      const lines = code.split("\n").map(line => line.trim()).filter(l => l !== "");
      let queue = [];
      let pq = [];

      codeExecution.innerHTML = lines
        .map((line, i) => `<div id="line-${i}" class="code-line">${line}</div>`)
        .join("");

      const highlightLine = (index) => {
        lines.forEach((_, i) => {
          const lineDiv = document.getElementById(`line-${i}`);
          if (!lineDiv) return;
          if (i === index) lineDiv.classList.add("highlight");
          else lineDiv.classList.remove("highlight");
        });
      };

      if (queueType.value === "queue") {
        for (let i = 0; i < lines.length; i++) {
          highlightLine(i);
          const line = lines[i];

          // Initialize queue
          if (/let\s+queue\s*=\s*\[\s*\];?/.test(line)) {
            queue = [];
            renderQueue(queue);
            peekInfo.textContent = "";
            sizeInfo.textContent = "";
            appendOutput("Initialized empty queue.");
            await new Promise(r => setTimeout(r, 1000));
            continue;
          }

          // queue.push(val)
          let pushMatch = line.match(/queue\.push\((.+)\);?/);
          if (pushMatch) {
            try {
              const val = eval(pushMatch[1]);
              queue.push(val);
              renderQueue(queue, queue.length - 1, "add");
              appendOutput(`Enqueued ${val} at back.`);
              await new Promise(r => setTimeout(r, 1200));
            } catch (e) {
              appendOutput("Failed to eval queue.push value.");
            }
            continue;
          }
          // queue.unshift(val)
          let unshiftMatch = line.match(/queue\.unshift\((.+)\);?/);
          if (unshiftMatch) {
            try {
              const val = eval(unshiftMatch[1]);
              queue.unshift(val);
              renderQueue(queue, 0, "add");
              appendOutput(`Enqueued ${val} at front.`);
              await new Promise(r => setTimeout(r, 1200));
            } catch (e) {
              appendOutput("Failed to eval queue.unshift value.");
            }
            continue;
          }
          // queue.shift()
          if (/queue\.shift\(\);?/.test(line)) {
            if (queue.length > 0) {
              const removed = queue.shift();
              renderQueue(queue, 0, "remove");
              appendOutput(`Dequeued ${removed} from front.`);
              await new Promise(r => setTimeout(r, 1200));
            } else {
              appendOutput("Queue is empty. Nothing to dequeue from front.");
              await new Promise(r => setTimeout(r, 1000));
            }
            continue;
          }
          // queue.pop()
          if (/queue\.pop\(\);?/.test(line)) {
            if (queue.length > 0) {
              const removed = queue.pop();
              renderQueue(queue, queue.length, "remove");
              appendOutput(`Dequeued ${removed} from back.`);
              await new Promise(r => setTimeout(r, 1200));
            } else {
              appendOutput("Queue is empty. Nothing to dequeue from back.");
              await new Promise(r => setTimeout(r, 1000));
            }
            continue;
          }
          // peek front: queue[0]
          if (line.includes("queue[0]")) {
            if (queue.length > 0) {
              peekInfo.textContent = `Front (peek): ${queue[0]}`;
              appendOutput(`Peek front: ${queue[0]}`);
            } else {
              peekInfo.textContent = "Queue is empty, no front element";
              appendOutput("Queue is empty, no front element");
            }
            await new Promise(r => setTimeout(r, 1000));
            continue;
          }
          // peek back: queue[queue.length - 1]
          if (line.includes("queue[queue.length - 1]")) {
            if (queue.length > 0) {
              peekInfo.textContent = `Back (peek): ${queue[queue.length - 1]}`;
              appendOutput(`Peek back: ${queue[queue.length - 1]}`);
            } else {
              peekInfo.textContent = "Queue is empty, no back element";
              appendOutput("Queue is empty, no back element");
            }
            await new Promise(r => setTimeout(r, 1000));
            continue;
          }
          // size property
          if (line.includes("queue.length")) {
            sizeInfo.textContent = `Size: ${queue.length}`;
            appendOutput(`Queue size: ${queue.length}`);
            await new Promise(r => setTimeout(r, 800));
            continue;
          }

          await new Promise(r => setTimeout(r, 800));
        }
        highlightLine(-1);
        peekInfo.textContent = "";
        sizeInfo.textContent = "";
      } else {
        for (let i = 0; i < lines.length; i++) {
          highlightLine(i);
          const line = lines[i];

          // Initialize priority queue
          if (/let\s+pq\s*=\s*\[\s*\];?/.test(line)) {
            pq = [];
            renderPQ(pq);
            pqPeekInfo.textContent = "";
            pqSizeInfo.textContent = "";
            appendOutput("Initialized empty priority queue.");
            await new Promise(r => setTimeout(r, 1000));
            continue;
          }

          // pq.push([val, priority])
          let pushPQMatch = line.match(/pq\.push\(\s*\[([^,]+),\s*([^\]]+)\]\s*\);?/);
          if (pushPQMatch) {
            try {
              const val = eval(pushPQMatch[1]);
              const priority = eval(pushPQMatch[2]);
              pq.push([val, priority]);
              // Sort descending by priority (higher priority first)
              pq.sort((a,b) => b[1] - a[1]);
              renderPQ(pq, 0, "add");
              appendOutput(`Enqueued ${val} with priority ${priority}.`);
              await new Promise(r => setTimeout(r, 1200));
            } catch (e) {
              appendOutput("Failed to eval pq.push value.");
            }
            continue;
          }
          // pq.shift() dequeue highest priority
          if (/pq\.shift\(\);?/.test(line)) {
            if (pq.length > 0) {
              const removed = pq.shift();
              renderPQ(pq, 0, "remove");
              appendOutput(`Dequeued ${removed[0]} (priority ${removed[1]}) from priority queue.`);
              await new Promise(r => setTimeout(r, 1200));
            } else {
              appendOutput("Priority queue is empty. Nothing to dequeue.");
              await new Promise(r => setTimeout(r, 1000));
            }
            continue;
          }
          // peek highest priority element
          if (line.includes("pq[0]")) {
            if (pq.length > 0) {
              pqPeekInfo.textContent = `Highest priority element: ${pq[0][0]} (priority: ${pq[0][1]})`;
              appendOutput(`Peek highest priority: ${pq[0][0]} (priority: ${pq[0][1]})`);
            } else {
              pqPeekInfo.textContent = "Priority queue is empty";
              appendOutput("Priority queue is empty");
            }
            await new Promise(r => setTimeout(r, 1000));
            continue;
          }
          // size property
          if (line.includes("pq.length")) {
            pqSizeInfo.textContent = `Size: ${pq.length}`;
            appendOutput(`Priority queue size: ${pq.length}`);
            await new Promise(r => setTimeout(r, 800));
            continue;
          }

          await new Promise(r => setTimeout(r, 800));
        }
        highlightLine(-1);
        pqPeekInfo.textContent = "";
        pqSizeInfo.textContent = "";
      }
    });
  </script>
</body>
</html>